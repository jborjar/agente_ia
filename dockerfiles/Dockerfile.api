# =============================================================
# API Unificada - Orquesta STT, LLM y TTS
# =============================================================
# Servicio que combina STT, LLM y TTS en un solo endpoint
# - Siempre retorna texto + audio (OGG base64)
# - ffmpeg para conversion WAV → OGG Opus
# - poppler para PDF → imagenes
# - libreoffice para Office → PDF
# =============================================================

FROM python:3.11-slim

ENV TZ=America/Mexico_City
ENV LANG=es_MX.UTF-8

# Instalar ffmpeg, poppler, libreoffice y locales
RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg \
    poppler-utils \
    libreoffice-writer \
    libreoffice-calc \
    libreoffice-impress \
    locales \
    && sed -i '/es_MX.UTF-8/s/^# //g' /etc/locale.gen \
    && locale-gen \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copiamos requirements para aprovechar cache de Docker
COPY app/api/requirements.txt .

RUN pip install --no-cache-dir --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt

EXPOSE 8000

# Endpoints: POST /chat, POST /voice, POST /image, POST /document, POST /classify
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
